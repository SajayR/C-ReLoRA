experiment:
  name: vit-base-commutator-16
  name_suffix: rank-16
  seed: 42
  device: auto
  output_dir: ./runs

model:
  name: vit_base_commutator
  params:
    model_name: google/vit-base-patch16-224
    dropout: 0.1
    freeze_backbone: true
    gradient_checkpointing: false
    commutator:
      enabled: true
      r: 16
      alpha: 32
      dropout: 0.1
      skew: false
      target_modules:
        ["query", "key", "value", "output.dense", "intermediate.dense"]
      init_std_scale: 1.0
      gain:
        enabled: false
        mode: per_out
        n_heads: null

training:
  epochs: 5
  gradient_clip_norm: 1.0
  grad_accumulation: 1
  log_every: 1
  eval_every: 1
  save_every: 1
  precision:
    enabled: true
    dtype: bf16
    grad_scaler: false
  optimizer:
    type: adamw
    lr: 0.0003
    weight_decay: 0.05
    betas: [0.9, 0.999]
    eps: 0.00000001
  scheduler:
    type: cosine
    warmup: 0.1
    min_lr_mult: 0.1
  monitor:
    grad_norm: true
    param_norm: true
    memory: true

data:
  root: /speedy/datasets
  image_size: 224
  batch_size: 128
  num_workers: 8
  pin_memory: true
  persistent_workers: true
  normalization: imagenet
  augment: true
  drop_last: true

logging:
  use_wandb: true
  project: cis-testbed
  entity: null
  run_name: null
  group: null
  tags: ["vit", "commutator", "16"]
  notes: null

datasets:
  - name: cifar-100
    val_split: test
    normalization: vit
  - name: ImageNet
    val_split: test
    normalization: vit
